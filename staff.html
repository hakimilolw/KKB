<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KKB Staff POS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .pos-grid {
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        }
        .order-item:last-child {
            border-bottom: none;
        }
        .modal {
            transition: opacity 0.25s ease;
        }
        .modal-content {
            transition: transform 0.25s ease;
        }
        .size-btn.active {
            background-color: #3b82f6;
            color: white;
        }
        .category-tab.active {
            border-bottom-color: #3b82f6;
            color: #3b82f6;
            font-weight: 600;
        }
    </style>
</head>
<body class="bg-gray-200 h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-white shadow-md w-full flex-shrink-0">
        <div class="px-4 py-2 flex justify-between items-center">
            <div class="flex items-center">
                <img src="https://placehold.co/40x40/dc2626/FFFFFF?text=KKB" alt="Logo" class="rounded-full mr-3">
                <h1 class="text-xl font-bold text-gray-800">KKB POS</h1>
            </div>
            <div class="flex items-center">
                <button id="history-btn" class="font-semibold text-gray-700 mr-4 hover:text-blue-600"><i class="fas fa-history mr-1"></i>History</button>
                <span class="font-semibold mr-4" id="current-time"></span>
                <i class="fas fa-wifi text-gray-600 mr-4"></i>
                <span class="font-semibold">Staff: Jane Doe</span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="flex-grow flex flex-col md:flex-row overflow-hidden">
        
        <!-- Order & Payment Sidebar -->
        <aside class="w-full md:w-1/3 bg-white flex flex-col p-4 shadow-lg">
            <div class="border-b pb-2 mb-4">
                <h2 class="text-lg font-bold">Current Order</h2>
            </div>
            <div id="order-items" class="flex-grow overflow-y-auto">
                <p class="text-gray-500 text-center mt-10">No items in order.</p>
            </div>
            <div class="flex-shrink-0 pt-4 border-t">
                <div class="flex justify-between font-bold text-xl mb-4">
                    <span>Total</span>
                    <span id="total">RM0.00</span>
                </div>
                <div class="grid grid-cols-2 gap-2">
                    <button id="save-btn" class="bg-orange-500 text-white font-bold py-3 rounded-lg">SAVE</button>
                    <button id="pay-btn" class="bg-green-500 text-white font-bold py-3 rounded-lg">PAY</button>
                </div>
            </div>
        </aside>

        <!-- Menu & Orders -->
        <main class="w-full md:w-2/3 flex flex-col bg-gray-100">
            <!-- Category Tabs -->
            <div class="flex-shrink-0 bg-white border-b border-gray-200">
                <div id="category-tabs" class="flex space-x-4 px-4 overflow-x-auto">
                    <!-- Category tabs will be populated here -->
                </div>
            </div>
            <!-- Menu Grid -->
            <div class="flex-grow p-4 overflow-y-auto">
                <div id="menu-grid" class="pos-grid grid gap-3">
                    <!-- Menu items will be populated here -->
                </div>
            </div>
            <!-- Incoming Orders Queue -->
            <div class="flex-shrink-0 h-1/3 bg-white p-4 border-t-2 border-gray-300 overflow-hidden flex flex-col">
                <div class="flex justify-between items-center mb-2">
                    <h3 class="text-lg font-bold">Incoming Orders</h3>
                    <button id="simulate-order-btn" class="text-sm bg-blue-500 text-white px-3 py-1 rounded-lg">Simulate New Order</button>
                </div>
                <div id="orders-queue" class="flex-grow overflow-y-auto space-y-2">
                    <p class="text-gray-500 text-center mt-4">No new online orders.</p>
                </div>
            </div>
        </main>
    </div>

    <!-- Item Customization Modal -->
    <div id="pos-item-modal" class="modal fixed inset-0 bg-gray-900 bg-opacity-50 hidden items-center justify-center z-50">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-2xl transform scale-95 flex flex-col max-h-[90vh]">
            <div class="p-4 border-b flex-shrink-0">
                <h3 class="text-xl font-semibold text-gray-800" id="modal-title">Customize Item</h3>
            </div>
            <div id="modal-body" class="p-4 flex-grow overflow-y-auto">
                <!-- Content generated by JS -->
            </div>
            <div class="p-4 border-t flex-shrink-0 bg-gray-50 flex justify-between items-center">
                <span class="text-xl font-bold" id="modal-price">RM0.00</span>
                <div>
                    <button id="cancel-modal-btn" class="bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 mr-2">Cancel</button>
                    <button id="add-to-order-btn" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">Add to Order</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Saved Orders Modal -->
    <div id="saved-orders-modal" class="modal fixed inset-0 bg-gray-900 bg-opacity-50 hidden items-center justify-center z-50">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-lg transform scale-95 flex flex-col max-h-[90vh]">
            <div class="p-4 border-b flex-shrink-0 flex justify-between items-center">
                <h3 class="text-xl font-semibold text-gray-800">Unpaid Orders</h3>
                <button id="close-saved-modal-btn" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
            </div>
            <div id="saved-orders-list" class="p-4 flex-grow overflow-y-auto">
                <!-- Saved orders will be populated here -->
            </div>
        </div>
    </div>
    
    <!-- Order History Modal -->
    <div id="history-modal" class="modal fixed inset-0 bg-gray-900 bg-opacity-50 hidden items-center justify-center z-50">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-4xl transform scale-95 flex flex-col max-h-[90vh]">
            <div class="p-4 border-b flex-shrink-0 flex justify-between items-center">
                <h3 class="text-xl font-semibold text-gray-800">Order History</h3>
                <button id="close-history-modal-btn" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
            </div>
            <div id="history-list" class="p-4 flex-grow overflow-y-auto">
                <!-- History will be populated here -->
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const menuGrid = document.getElementById('menu-grid');
            const categoryTabsContainer = document.getElementById('category-tabs');
            const orderItemsContainer = document.getElementById('order-items');
            const totalEl = document.getElementById('total');
            const payBtn = document.getElementById('pay-btn');
            const saveBtn = document.getElementById('save-btn');
            const ordersQueueContainer = document.getElementById('orders-queue');
            const simulateOrderBtn = document.getElementById('simulate-order-btn');
            const timeEl = document.getElementById('current-time');
            const itemModal = document.getElementById('pos-item-modal');
            const savedOrdersModal = document.getElementById('saved-orders-modal');
            const historyModal = document.getElementById('history-modal');
            const historyBtn = document.getElementById('history-btn');

            let currentOrder = [];
            let savedOrders = [];
            let completedOrders = [];
            let currentItemForModal = null;
            
            const menuData = {
                items: [
                    { id: 'item-1', name: "Spanish Latte", type: "drink", basePrice: 12.00, category: "Coffee" },
                    { id: 'item-2', name: "Sarawak Latte", type: "drink", basePrice: 12.00, category: "Coffee" },
                    { id: 'item-3', name: "Café Latte", type: "drink", basePrice: 10.00, category: "Coffee" },
                    { id: 'item-4', name: "Americano", type: "drink", basePrice: 7.00, category: "Coffee" },
                    { id: 'item-5', name: "Mocha Frappé", type: "drink", basePrice: 14.00, category: "Coffee" },
                    { id: 'item-9', name: "Hot Chocolate", type: "hot-drink", basePrice: 9.00, category: "Non-Coffee" },
                    { id: 'item-10', name: "Beefy Tugau", type: "food", priceDisplay: "RM8.50", basePrice: 8.50, category: "Burgers" },
                    { id: 'item-11', name: "Loaded Fries", type: "food", priceDisplay: "RM10.00", basePrice: 10.00, category: "Snacks" },
                    { id: 'item-12', name: "Biscoff Waffle", type: "food", priceDisplay: "RM10.00", basePrice: 10.00, category: "Waffles" },
                ]
            };
            const addOnsData = [
                { name: "Oatside Milk", type: "Milk Option", price: 2.00 },
                { name: "Coconut Milk", type: "Milk Option", price: 3.00 },
                { name: "Extra Espresso Shot", type: "Coffee", price: 4.00 },
                { name: "Vanilla Syrup", type: "Syrup", price: 2.00 },
                { name: "Caramel Syrup", type: "Syrup", price: 2.00 },
                { name: "Chocolate Drizzle", type: "Drizzle", price: 1.00 },
                { name: "Oreo Crumbs", type: "Topping", price: 1.00 },
            ];

            function updateTime() {
                timeEl.textContent = new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
            }
            setInterval(updateTime, 1000);
            updateTime();

            function renderCategories() {
                const categories = ["All", ...new Set(menuData.items.map(item => item.category))];
                categoryTabsContainer.innerHTML = '';
                categories.forEach(category => {
                    const tab = document.createElement('button');
                    tab.className = 'category-tab py-3 px-2 text-sm text-gray-500 border-b-2 border-transparent';
                    if (category === "All") {
                        tab.classList.add('active');
                    }
                    tab.textContent = category;
                    tab.dataset.category = category;
                    categoryTabsContainer.appendChild(tab);
                });

                categoryTabsContainer.addEventListener('click', (e) => {
                    if (e.target.classList.contains('category-tab')) {
                        document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
                        e.target.classList.add('active');
                        renderMenu(e.target.dataset.category);
                    }
                });
            }

            function renderMenu(category = "All") {
                menuGrid.innerHTML = '';
                const itemsToRender = category === "All" 
                    ? menuData.items 
                    : menuData.items.filter(item => item.category === category);

                itemsToRender.forEach(item => {
                    const button = document.createElement('button');
                    button.className = 'bg-blue-500 text-white font-semibold p-3 rounded-lg shadow-md hover:bg-blue-600 flex flex-col justify-between h-28';
                    button.innerHTML = `
                        <span class="text-left">${item.name}</span>
                        <span class="text-right text-lg font-bold">${item.type === 'food' ? item.priceDisplay : `RM${item.basePrice.toFixed(2)}`}</span>
                    `;
                    button.addEventListener('click', () => openItemModal(item));
                    menuGrid.appendChild(button);
                });
            }

            function addToOrder(item) {
                currentOrder.push(item);
                renderOrder();
            }

            function renderOrder() {
                orderItemsContainer.innerHTML = '';
                if (currentOrder.length === 0) {
                    orderItemsContainer.innerHTML = `<p class="text-gray-500 text-center mt-10">No items in order.</p>`;
                    updateTotals();
                    return;
                }

                currentOrder.forEach((item, index) => {
                    const itemEl = document.createElement('div');
                    itemEl.className = 'order-item py-2 border-b';
                    let addOnsHtml = (item.addOns || []).map(a => `<li class="text-xs text-gray-500">${a.name}</li>`).join('');
                    if(addOnsHtml) addOnsHtml = `<ul class="list-disc list-inside ml-4">${addOnsHtml}</ul>`;

                    itemEl.innerHTML = `
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="font-semibold">${item.name} <span class="text-sm font-normal text-gray-500">${item.size || ''}</span></p>
                            </div>
                            <div class="flex items-center">
                                <span class="w-20 text-right font-semibold">RM${item.finalPrice.toFixed(2)}</span>
                                <button class="delete-item-btn text-red-500 hover:text-red-700 ml-3" data-index="${index}"><i class="fas fa-trash-alt"></i></button>
                            </div>
                        </div>
                        ${addOnsHtml}
                    `;
                    orderItemsContainer.appendChild(itemEl);
                });

                document.querySelectorAll('.delete-item-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const index = e.currentTarget.dataset.index;
                        currentOrder.splice(index, 1);
                        renderOrder();
                    });
                });

                updateTotals();
            }

            function updateTotals() {
                const total = currentOrder.reduce((sum, item) => sum + item.finalPrice, 0);
                totalEl.textContent = `RM${total.toFixed(2)}`;
            }

            function openItemModal(item) {
                currentItemForModal = item;
                const modalBody = document.getElementById('modal-body');
                document.getElementById('modal-title').textContent = `Customize: ${item.name}`;
                
                modalBody.innerHTML = '';

                // Size options
                if (item.type === 'drink' || item.type === 'hot-drink') {
                    const sizes = item.type === 'drink' ? [12, 16, 22] : [12];
                    let sizeHtml = '<div class="mb-4"> <h4 class="font-semibold mb-2">Size</h4> <div class="flex space-x-2">';
                    sizes.forEach((size, index) => {
                        sizeHtml += `<button class="size-btn border px-4 py-2 rounded-lg ${index === 0 ? 'active' : ''}" data-size="${size}">${size}oz</button>`;
                    });
                    sizeHtml += '</div></div>';
                    modalBody.innerHTML += sizeHtml;
                }

                // Add-on options
                const addonTypes = [...new Set(addOnsData.map(a => a.type))];
                addonTypes.forEach(type => {
                    const relevantAddons = addOnsData.filter(a => a.type === type);
                    let addonHtml = `<div class="mb-4"> <h4 class="font-semibold mb-2">${type}</h4> <div class="space-y-2">`;
                    const inputType = type === 'Milk Option' ? 'radio' : 'checkbox';
                    relevantAddons.forEach(addon => {
                        addonHtml += `
                            <label class="flex items-center p-2 rounded-lg bg-gray-100">
                                <input type="${inputType}" name="${type}" class="mr-3 h-4 w-4" data-price="${addon.price}" data-name="${addon.name}">
                                <span>${addon.name}</span>
                                <span class="ml-auto font-semibold">+RM${addon.price.toFixed(2)}</span>
                            </label>
                        `;
                    });
                    addonHtml += '</div></div>';
                    modalBody.innerHTML += addonHtml;
                });

                itemModal.querySelectorAll('input, .size-btn').forEach(el => {
                    el.addEventListener('click', updateModalPrice);
                });

                updateModalPrice();
                toggleModal(itemModal, true);
            }

            function updateModalPrice() {
                let price = currentItemForModal.basePrice;
                
                const selectedSizeEl = itemModal.querySelector('.size-btn.active');
                if (selectedSizeEl) {
                    const size = parseInt(selectedSizeEl.dataset.size);
                    if (size === 16) price += 1;
                    if (size === 22) price += 2;
                }

                itemModal.querySelectorAll('input:checked').forEach(input => {
                    price += parseFloat(input.dataset.price);
                });

                document.getElementById('modal-price').textContent = `RM${price.toFixed(2)}`;
            }

            function toggleModal(modal, show) {
                const content = modal.querySelector('.modal-content');
                if (show) {
                    modal.classList.remove('hidden');
                    setTimeout(() => {
                        modal.classList.remove('opacity-0');
                        content.classList.remove('scale-95');
                    }, 10);
                } else {
                    modal.classList.add('opacity-0');
                    content.classList.add('scale-95');
                    setTimeout(() => modal.classList.add('hidden'), 250);
                }
            }
            
            function addOrderToQueue(order) {
                if (ordersQueueContainer.querySelector('p')) {
                    ordersQueueContainer.innerHTML = '';
                }
                const orderCard = document.createElement('div');
                orderCard.className = 'bg-gray-100 p-2 rounded-lg flex justify-between items-center';
                const itemsSummary = order.items.map(item => `${item.quantity}x ${item.name}`).join(', ');
                orderCard.innerHTML = `
                    <div>
                        <p class="font-bold">Order #${order.id} (Online)</p>
                        <p class="text-sm text-gray-600">${itemsSummary}</p>
                    </div>
                    <button class="bg-green-500 text-white px-3 py-1 rounded-lg text-sm">Done</button>
                `;
                ordersQueueContainer.prepend(orderCard);
            }

            function renderSavedOrders() {
                const container = document.getElementById('saved-orders-list');
                container.innerHTML = '';
                if (savedOrders.length === 0) {
                    container.innerHTML = `<p class="text-gray-500 text-center p-4">No unpaid orders found.</p>`;
                    return;
                }
                savedOrders.forEach((order, index) => {
                    const total = order.items.reduce((sum, item) => sum + item.finalPrice, 0);
                    const orderEl = document.createElement('div');
                    orderEl.className = 'p-3 mb-2 bg-gray-100 rounded-lg cursor-pointer hover:bg-gray-200';
                    orderEl.dataset.index = index;
                    orderEl.innerHTML = `
                        <div class="flex justify-between items-center">
                            <span class="font-semibold">${order.name}</span>
                            <span class="font-bold">RM${total.toFixed(2)}</span>
                        </div>
                        <p class="text-xs text-gray-600">${order.items.length} items</p>
                    `;
                    orderEl.addEventListener('click', () => {
                        loadSavedOrder(index);
                    });
                    container.appendChild(orderEl);
                });
            }
            
            function renderOrderHistory() {
                const container = document.getElementById('history-list');
                container.innerHTML = '';
                if (completedOrders.length === 0) {
                    container.innerHTML = `<p class="text-gray-500 text-center p-4">No completed orders yet.</p>`;
                    return;
                }
                
                const sortedHistory = [...completedOrders].reverse();
                sortedHistory.forEach(order => {
                    const itemsSummary = order.items.map(item => `<li>${item.name} - RM${item.finalPrice.toFixed(2)}</li>`).join('');
                    const orderEl = document.createElement('div');
                    orderEl.className = 'p-4 mb-3 bg-gray-100 rounded-lg';
                    orderEl.innerHTML = `
                        <div class="flex justify-between items-center border-b pb-2 mb-2">
                            <div>
                                <p class="font-bold text-lg">Order #${order.id}</p>
                                <p class="text-xs text-gray-600">${order.timestamp.toLocaleString()}</p>
                            </div>
                            <span class="font-bold text-xl text-green-600">RM${order.total.toFixed(2)}</span>
                        </div>
                        <ul class="list-disc list-inside text-sm">${itemsSummary}</ul>
                    `;
                    container.appendChild(orderEl);
                });
            }

            function loadSavedOrder(index) {
                currentOrder = savedOrders[index].items;
                savedOrders.splice(index, 1);
                renderOrder();
                toggleModal(savedOrdersModal, false);
            }

            document.getElementById('cancel-modal-btn').addEventListener('click', () => toggleModal(itemModal, false));
            document.getElementById('close-saved-modal-btn').addEventListener('click', () => toggleModal(savedOrdersModal, false));
            document.getElementById('close-history-modal-btn').addEventListener('click', () => toggleModal(historyModal, false));
            
            document.getElementById('add-to-order-btn').addEventListener('click', () => {
                const finalPrice = parseFloat(document.getElementById('modal-price').textContent.replace('RM', ''));
                const selectedSizeEl = itemModal.querySelector('.size-btn.active');
                const size = selectedSizeEl ? `${selectedSizeEl.dataset.size}oz` : null;
                const addOns = Array.from(itemModal.querySelectorAll('input:checked')).map(input => ({
                    name: input.dataset.name,
                    price: parseFloat(input.dataset.price)
                }));

                const orderItem = {
                    ...currentItemForModal,
                    finalPrice: finalPrice,
                    size: size,
                    addOns: addOns
                };
                addToOrder(orderItem);
                toggleModal(itemModal, false);
            });

            saveBtn.addEventListener('click', () => {
                if (currentOrder.length > 0) {
                    const customerName = prompt("Enter customer name or identifier:", `Customer ${savedOrders.length + 1}`);
                    if (customerName) {
                        savedOrders.push({ name: customerName, items: [...currentOrder] });
                        alert(`Order for ${customerName} saved!`);
                        currentOrder = [];
                        renderOrder();
                    }
                } else {
                    renderSavedOrders();
                    toggleModal(savedOrdersModal, true);
                }
            });

            payBtn.addEventListener('click', () => {
                if (currentOrder.length > 0) {
                    const total = currentOrder.reduce((sum, item) => sum + item.finalPrice, 0);
                    completedOrders.push({
                        id: Math.floor(10000 + Math.random() * 90000),
                        items: [...currentOrder],
                        total: total,
                        timestamp: new Date()
                    });
                    alert('Payment processed!');
                    currentOrder = [];
                    renderOrder();
                } else {
                    alert('No items in order.');
                }
            });
            
            historyBtn.addEventListener('click', () => {
                renderOrderHistory();
                toggleModal(historyModal, true);
            });

            simulateOrderBtn.addEventListener('click', () => {
                const randomId = Math.floor(1000 + Math.random() * 9000);
                const newOnlineOrder = {
                    id: randomId,
                    items: [
                        { name: "Sarawak Latte", quantity: 1 },
                        { name: "Beefy Tugau", quantity: 2 }
                    ]
                };
                addOrderToQueue(newOnlineOrder);
            });

            renderCategories();
            renderMenu();
        });
    </script>
</body>
</html>
